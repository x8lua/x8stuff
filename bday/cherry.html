<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cherry</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&family=Google+Sans:opsz,wght@17..18,400..700&family=LXGW+WenKai+TC&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<script src="https://unpkg.com/twemoji@latest/dist/twemoji.min.js" crossorigin="anonymous"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
img.emoji{height:1em;width:1em;margin:0 .05em 0 .1em;vertical-align:-.1em;display:inline}
body{width:100vw;height:100vh;overflow:hidden;font-family:'Quicksand','Microsoft YaHei','PingFang SC',sans-serif;color:#fff;background:#0a0a1a}
/* BG IMAGE */
.bg-img{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:0;background:url('https://raw.githubusercontent.com/x8lua/x8stuff/main/bday/bg.jpeg') center 15%/cover no-repeat;opacity:.5}
/* MESH GRADIENT */
.mesh-bg{position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:0;overflow:hidden}
.blob{position:absolute;border-radius:50%;filter:blur(100px);opacity:.35;will-change:transform}
.b1{width:50vw;height:50vw;background:#ff9a9e;top:10%;left:5%}
.b2{width:45vw;height:45vw;background:#a18cd1;top:5%;left:55%}
.b3{width:40vw;height:40vw;background:#96e6a1;top:55%;left:30%}
.b4{width:35vw;height:35vw;background:#ffecd2;top:50%;left:70%}
/* FLOATERS */
#floaters{position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:1;overflow:hidden}
.floater{position:absolute;font-size:clamp(1.2rem,2.5vw,2rem);opacity:.25;will-change:transform}
/* SLIDES */
.slide{position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;visibility:hidden;opacity:0;z-index:2}
.slide.active{visibility:visible;opacity:1;z-index:3}
/* NAV */
#nav{position:fixed;bottom:32px;right:36px;display:flex;align-items:center;gap:12px;z-index:200}
#nav button{width:50px;height:50px;border-radius:50%;border:2px solid rgba(255,255,255,.25);background:rgba(255,255,255,.08);color:#fff;font-size:1.5rem;cursor:pointer;backdrop-filter:blur(12px);transition:.3s;font-family:inherit}
#nav button:hover{background:rgba(255,255,255,.2);border-color:rgba(255,255,255,.5);transform:scale(1.1)}
#nav button:disabled{opacity:.2;cursor:default;pointer-events:none}
.page-ind{color:rgba(255,255,255,.45);font-size:.9rem;font-weight:600;min-width:36px;text-align:center}
/* SLIDE 1 */
.s1-wrap{text-align:center;z-index:10}
.s1-emoji{font-size:clamp(3rem,6vw,5rem);margin-bottom:.5rem}
.s1-title{font-size:clamp(5rem,14vw,12rem);font-weight:700;background:linear-gradient(135deg,#ff9a9e,#fad0c4,#a18cd1,#96e6a1,#ffecd2);background-size:300% 300%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:gtxt 5s ease infinite;line-height:1.15;letter-spacing:.05em}
@keyframes gtxt{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.s1-name{font-size:clamp(2rem,5vw,4rem);font-weight:600;margin-top:.8rem;opacity:.85;letter-spacing:.15em}
.s1-sub{font-size:clamp(1rem,2vw,1.6rem);margin-top:1.2rem;opacity:.5;font-weight:400;letter-spacing:.2em}
.s1-credit{position:fixed;bottom:16px;left:20px;font-size:.7rem;opacity:.25;font-weight:400;z-index:200}
/* SLIDE 2 */
.s2-wrap{display:flex;align-items:center;gap:clamp(2.5rem,5vw,5rem);padding:0 7vw;max-width:1500px;width:100%;z-index:10}
.s2-photo{width:clamp(260px,28vw,420px);height:clamp(340px,36vw,540px);border-radius:30px;background:linear-gradient(135deg,#ff9a9e,#a18cd1,#96e6a1,#ffecd2);background-size:200% 200%;animation:gtxt 5s ease infinite;padding:5px;flex-shrink:0}
.s2-inner{width:100%;height:100%;border-radius:26px;background:rgba(15,15,30,.8);backdrop-filter:blur(10px);display:flex;justify-content:center;align-items:center;font-size:5rem;overflow:hidden}
.s2-inner img{width:100%;height:100%;object-fit:cover}
.s2-text{flex:1}
.s2-text h2{font-size:clamp(2.2rem,4.5vw,3.8rem);font-weight:700;margin-bottom:1.2rem;background:linear-gradient(90deg,#ff9a9e,#ffecd2,#a18cd1);background-size:200% 200%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:gtxt 4s ease infinite}
.s2-text p{font-size:clamp(1.2rem,2vw,1.7rem);line-height:1.9;opacity:.78;font-weight:400}
.s2-sig{margin-top:1.8rem;font-size:clamp(1rem,1.5vw,1.2rem);opacity:.4;font-style:italic}
/* SLIDE 3 â€” CHERRY BLIND BOX */
.s3-wrap{display:flex;flex-direction:column;align-items:center;gap:clamp(1rem,2vw,1.8rem);z-index:10}
.s3-title{font-size:clamp(1.8rem,3.5vw,2.8rem);font-weight:700;background:linear-gradient(90deg,#ff9a9e,#ffecd2,#a18cd1);background-size:200% 200%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:gtxt 4s ease infinite;margin-bottom:.5rem}
.photo-row{display:flex;gap:clamp(16px,2vw,28px);justify-content:center;flex-wrap:wrap}
.photo-frame{position:relative;width:clamp(180px,20vw,280px);height:clamp(240px,27vw,370px);border-radius:22px;cursor:pointer;perspective:600px;flex-shrink:0;-webkit-tap-highlight-color:transparent;user-select:none}
.photo-frame .card-face{width:100%;height:100%;border-radius:22px;overflow:hidden;position:relative;background:rgba(255,255,255,.07);border:1.5px solid rgba(255,255,255,.15);backdrop-filter:blur(12px);transition:box-shadow .45s,border-color .4s;transform-style:preserve-3d}
.photo-frame:hover .card-face{border-color:rgba(255,255,255,.4);box-shadow:0 12px 40px rgba(161,140,209,.35),0 0 20px rgba(255,154,158,.2)}
.photo-frame::before{content:'';position:absolute;inset:-2px;border-radius:24px;background:conic-gradient(from var(--angle,0deg),#ff9a9e,#a18cd1,#96e6a1,#ffecd2,#ff9a9e);z-index:-1;opacity:0;transition:opacity .4s;animation:borderSpin 4s linear infinite}
.photo-frame:hover::before{opacity:.6}
@property --angle{syntax:'<angle>';initial-value:0deg;inherits:false}
@keyframes borderSpin{to{--angle:360deg}}
/* Locked chest placeholder */
.chest-img{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:clamp(3rem,5vw,4.5rem);background:linear-gradient(135deg,rgba(255,154,158,.15),rgba(161,140,209,.2),rgba(150,230,161,.1));border-radius:22px;position:relative}
.chest-img::after{content:'';position:absolute;inset:0;background:repeating-linear-gradient(45deg,transparent,transparent 10px,rgba(255,255,255,.03) 10px,rgba(255,255,255,.03) 20px);border-radius:22px}
/* Revealed photo (hidden initially) */
.photo-img{width:100%;height:100%;object-fit:cover;display:none;border-radius:22px}
/* Progress bar */
.chest-progress{position:absolute;bottom:0;left:0;right:0;height:6px;background:rgba(0,0,0,.4);border-radius:0 0 22px 22px;overflow:hidden;z-index:5}
.chest-bar{height:100%;width:0%;background:linear-gradient(90deg,#ff9a9e,#a18cd1,#96e6a1);border-radius:0 0 22px 22px;transition:width .2s ease}
/* Click counter */
.chest-counter{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:clamp(1.2rem,2vw,1.6rem);font-weight:700;color:#fff;text-shadow:0 2px 10px rgba(0,0,0,.6);z-index:5;pointer-events:none;opacity:.8}
/* Label */
.photo-frame.unlocked .chest-progress{display:none}
.photo-frame.unlocked .chest-counter{display:none}
.photo-frame.unlocked .chest-img{display:none}
.photo-frame.unlocked .photo-img{display:block}
/* Shake on click */
@keyframes chestShake{0%,100%{transform:translateX(0) rotate(0)}15%{transform:translateX(-4px) rotate(-2deg)}30%{transform:translateX(4px) rotate(2deg)}45%{transform:translateX(-3px) rotate(-1.5deg)}60%{transform:translateX(3px) rotate(1.5deg)}75%{transform:translateX(-2px) rotate(-1deg)}90%{transform:translateX(2px) rotate(1deg)}}
.shake .card-face{animation:chestShake .4s ease}
/* Shuffle state */
.photo-frame.shuffling{position:fixed!important;z-index:20;filter:blur(3px);transition:none}
.photo-frame.shuffling .card-face{animation:none!important}
.s3-subtitle{font-size:clamp(.9rem,1.5vw,1.1rem);opacity:.5;font-weight:400;letter-spacing:.1em;margin-top:-.5rem}
/* Stagger float animation */
.photo-frame:nth-child(1){--float-delay:0s}
.photo-frame:nth-child(2){--float-delay:.4s}
.photo-frame:nth-child(3){--float-delay:.8s}
.photo-frame:nth-child(4){--float-delay:.2s}
.photo-frame:nth-child(5){--float-delay:.6s}
.photo-frame:not(.unlocked) .card-face{animation:photoFloat 4s ease-in-out var(--float-delay) infinite}
@keyframes photoFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.photo-frame:hover:not(.unlocked) .card-face{animation:none}
/* Locked card */
.photo-frame.locked .card-face{animation:none!important;filter:grayscale(.5) brightness(.7)}
.photo-frame.locked{cursor:not-allowed;pointer-events:none}
.locked-overlay{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10;gap:8px;border-radius:22px;background:rgba(0,0,0,.3);backdrop-filter:blur(2px)}
.locked-overlay .lock-icon{font-size:clamp(2.5rem,4vw,3.5rem);filter:drop-shadow(0 0 10px rgba(255,154,158,.4));transition:transform .3s}
.locked-overlay .lock-text{font-size:clamp(.7rem,1.2vw,.9rem);opacity:.7;text-align:center;padding:0 12px;font-weight:600;letter-spacing:.05em}
/* Secret reveal */
.secret-phrase{position:fixed;bottom:8%;left:0;right:0;text-align:center;font-size:clamp(1.4rem,3.5vw,2.4rem);font-weight:700;color:#fff;text-shadow:0 2px 20px rgba(0,0,0,.5);z-index:15;padding:0 5%;line-height:1.8;letter-spacing:.1em;background:linear-gradient(90deg,#ff9a9e,#ffecd2,#a18cd1);background-size:200% 200%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:gtxt 4s ease infinite}
/* SLIDE 4 */
#slide-4{align-items:stretch;justify-content:stretch}
#stage{position:relative;width:100vw;height:100vh}
#backdrop{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(10,10,26,.75);opacity:0;z-index:50;pointer-events:none}
.card{position:absolute;border-radius:25px;opacity:0;will-change:transform,opacity;z-index:1;overflow:hidden;background:rgba(255,255,255,.1);backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);border:1.5px solid rgba(255,255,255,.2)}
.card-label{font-weight:600;padding:8% 10% 0;font-size:clamp(.65rem,1.4vw,1rem);opacity:.6;letter-spacing:.05em}
.card-msg{position:absolute;top:25%;left:8%;right:8%;font-weight:700;font-size:clamp(.9rem,1.8vw,1.4rem);line-height:1.4;color:#fff;overflow:hidden;display:-webkit-box;-webkit-line-clamp:5;line-clamp:5;-webkit-box-orient:vertical}
.card-author{position:absolute;bottom:7%;left:10%;right:8%;font-weight:600;font-size:clamp(.65rem,1.3vw,1rem);opacity:.55;display:flex;align-items:center;gap:5px}
/* FINALE */
#finale{position:fixed;top:0;left:0;width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;pointer-events:none;opacity:0;z-index:300}
#finale h1{font-size:clamp(4rem,10vw,8rem);color:#fff;text-shadow:0 0 40px rgba(255,154,158,.6),0 0 80px rgba(161,140,209,.4)}
/* MOBILE NOTICE */
#mobile-notice{position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(10,10,26,.95);display:flex;justify-content:center;align-items:center;z-index:500;backdrop-filter:blur(10px)}
#mobile-notice.hide{display:none}
.notice-box{background:rgba(255,255,255,.15);backdrop-filter:blur(20px);border:2px solid rgba(255,255,255,.3);border-radius:25px;padding:clamp(1.5rem,4vw,2.5rem);max-width:500px;margin:0 20px;text-align:center;box-shadow:0 0 40px rgba(255,154,158,.3)}
.notice-box p{font-size:clamp(1rem,2.5vw,1.3rem);line-height:1.6;opacity:.9;margin-bottom:1.5rem}
.notice-btn{background:linear-gradient(135deg,#ff9a9e,#fad0c4);border:none;border-radius:50px;padding:clamp(.8rem,2vw,1rem) clamp(2rem,5vw,3rem);font-size:clamp(1rem,2vw,1.2rem);font-weight:700;color:#fff;cursor:pointer;font-family:inherit;transition:.3s;box-shadow:0 4px 15px rgba(255,154,158,.4)}
.notice-btn:hover{transform:scale(1.05);box-shadow:0 6px 20px rgba(255,154,158,.6)}
/* INTRO */
#intro{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#0a0a1a;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:600}
.intro-content{display:flex;flex-direction:column;align-items:center;opacity:0;transform:scale(.9)}
.intro-title{font-size:clamp(3.5rem,10vw,8rem);font-weight:700;letter-spacing:.03em;color:#fff;font-family:'Google Sans','Product Sans',sans-serif;font-style:italic;padding-left:.03em}
.intro-line{width:clamp(60px,8vw,120px);height:1.5px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.4),transparent);margin:clamp(.6rem,1.2vw,1rem) 0}
.intro-sub{font-size:clamp(.7rem,1.4vw,1.1rem);font-weight:400;letter-spacing:.35em;color:rgba(255,255,255,.35);text-transform:uppercase;font-family:'Google Sans','Product Sans',sans-serif}
.intro-btn{margin-top:clamp(2rem,4vw,3.5rem);opacity:0;pointer-events:none}
.intro-hint{margin-top:clamp(1.5rem,3vw,2.5rem);font-size:clamp(.7rem,1.2vw,.95rem);color:rgba(255,255,255,.25);letter-spacing:.15em;opacity:0;font-family:'LXGW WenKai TC',cursive}
</style>
</head>
<body>
<!-- Background image -->
<div class="bg-img"></div>
<!-- Mesh gradient background blobs -->
<div class="mesh-bg">
  <div class="blob b1"></div><div class="blob b2"></div>
  <div class="blob b3"></div><div class="blob b4"></div>
</div>
<div id="floaters"></div>
<!-- Intro -->
<div id="intro" style="cursor:pointer">
  <div class="intro-content">
    <div class="intro-title">x8</div>
    <div class="intro-line"></div>
    <div class="intro-sub">production</div>
  </div>
  <div class="intro-hint">é»æ“Šä»»æ„ä½ç½®é–‹å§‹</div>
</div>
<!-- Mobile Notice -->
<div id="mobile-notice"><div class="notice-box"><p id="notice-text">ğŸ“± ç™¼ç¾ä½ æ˜¯æ‰‹æ©Ÿç«¯ï¼Œä½¿ç”¨é›»è…¦æ‰“é–‹æ•ˆæœæœƒæ›´å¥½</p><button class="notice-btn" onclick="startExperience()">é–‹å§‹</button></div></div>
<!-- Slide 1: Opener -->
<div id="slide-1" class="slide active">
  <div class="s1-wrap">
    <div class="s1-emoji">ğŸ‚</div>
    <h1 class="s1-title">ç”Ÿæ—¥å¿«æ¨‚</h1>
    <div class="s1-name">è¦ªæ„›çš„Cherry</div>
    <div class="s1-sub">å…¨ç­åŒå­¸ç»ä¸Šæœ€çœŸæ‘¯çš„ç¥ç¦</div>
  </div>
</div>
<!-- Slide 2: Tribute -->
<div id="slide-2" class="slide">
  <div class="s2-wrap">
    <div class="s2-photo"><div class="s2-inner"><img src="https://raw.githubusercontent.com/x8lua/x8stuff/main/bday/cherry.jpg" alt="è€å¸«"></div></div>
    <div class="s2-text">
      <h2>æœ€æ£’çš„è€å¸«</h2>
      <p>å¤šè¬ä½ ç”¨ç¬‘å®¹é™ªä¼´æˆ‘å“‹ï¼Œæ˜æ˜è‡ªå·±å¥½å®¹æ˜“è½æ·šï¼Œä»²ä¸€ç›´åŒ…å®¹ä½æˆ‘å“‹å˜…ä¸æ‡‚äº‹ï¼Œä½†ä¿‚æˆ‘å“‹å¿ƒç›®ä¸­ä½ ä¿‚æœ€éšå˜…ã€‚æˆ‘å“‹æˆæ—¥æ¬ åŠŸèª²ã€çŠ¯éŒ¯ã€æˆç¸¾å””å¤ å¥½ï¼Œä»¤æ‚¨æ“å¿ƒé›£éï¼ŒçœŸä¿‚å°å””ä½ã€‚ä»¥å¾Œæˆ‘å“‹ä¸€é½ŠåŠªåŠ›ï¼Œä¸€é½Šå‰é€²ï¼ç¥æ‚¨å¤©å¤©é–‹å¿ƒï¼Œå¹³å®‰å–œæ¨‚ï¼</p>
      <div class="s2-sig">â€” å…¨ç­åŒå­¸ æ•¬ä¸Š â™¥</div>
    </div>
  </div>
</div>
<!-- Slide 3: Photo Gallery -->
<div id="slide-3" class="slide">
  <div class="s3-wrap">
    <h2 class="s3-title">Cherry ç›²ç›’ ğŸ</h2>
    <p class="s3-subtitle" id="s3-sub">æ­£åœ¨æ‰“äº‚ä¸­...</p>
    <div class="photo-row">
      <div class="photo-frame" data-clicks="0" data-need="6">
        <div class="card-face">
          <div class="chest-img">ğŸ</div>
          <img class="photo-img" src="https://i.ibb.co/ZRc4KHt0/3dfa6711c82e57e7276da544f066ce9f.jpg" alt="ç…§ç‰‡ 1">
          <div class="chest-progress"><div class="chest-bar"></div></div>
          <div class="chest-counter">é»æ“Š 6 æ¬¡é–‹å•Ÿ</div>
        </div>
      </div>
      <div class="photo-frame" data-clicks="0" data-need="6">
        <div class="card-face">
          <div class="chest-img">ğŸ</div>
          <img class="photo-img" src="https://i.ibb.co/ZRc4KHt0/3dfa6711c82e57e7276da544f066ce9f.jpg" alt="ç…§ç‰‡ 2">
          <div class="chest-progress"><div class="chest-bar"></div></div>
          <div class="chest-counter">é»æ“Š 6 æ¬¡é–‹å•Ÿ</div>
        </div>
      </div>
      <div class="photo-frame" data-clicks="0" data-need="6">
        <div class="card-face">
          <div class="chest-img">ğŸ</div>
          <img class="photo-img" src="https://i.ibb.co/ZRc4KHt0/3dfa6711c82e57e7276da544f066ce9f.jpg" alt="ç…§ç‰‡ 3">
          <div class="chest-progress"><div class="chest-bar"></div></div>
          <div class="chest-counter">é»æ“Š 6 æ¬¡é–‹å•Ÿ</div>
        </div>
      </div>
    </div>
    <div class="photo-row">
      <div class="photo-frame" data-clicks="0" data-need="6">
        <div class="card-face">
          <div class="chest-img">ğŸ</div>
          <img class="photo-img" src="https://i.ibb.co/ZRc4KHt0/3dfa6711c82e57e7276da544f066ce9f.jpg" alt="ç…§ç‰‡ 4">
          <div class="chest-progress"><div class="chest-bar"></div></div>
          <div class="chest-counter">é»æ“Š 6 æ¬¡é–‹å•Ÿ</div>
        </div>
      </div>
      <div class="photo-frame" data-clicks="0" data-need="6">
        <div class="card-face">
          <div class="chest-img">ğŸ</div>
          <img class="photo-img" src="https://i.ibb.co/ZRc4KHt0/3dfa6711c82e57e7276da544f066ce9f.jpg" alt="ç…§ç‰‡ 5">
          <div class="chest-progress"><div class="chest-bar"></div></div>
          <div class="chest-counter">é»æ“Š 6 æ¬¡é–‹å•Ÿ</div>
        </div>
      </div>
      <div class="photo-frame locked" data-clicks="0" data-need="6" data-locked="true">
        <div class="card-face">
          <div class="chest-img">ğŸ”’</div>
          <img class="photo-img" src="" alt="ç…§ç‰‡ 6">
          <div class="chest-progress"><div class="chest-bar"></div></div>
          <div class="chest-counter">é»æ“Š 6 æ¬¡é–‹å•Ÿ</div>
          <div class="locked-overlay">
            <div class="lock-icon">ğŸ”’</div>
            <div class="lock-text">é–‹å•Ÿæ‰€æœ‰ç›²ç›’å¾Œè§£é–</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Slide 4: Card Wall -->
<div id="slide-4" class="slide"><div id="stage"></div><div id="backdrop"></div></div>
<div id="finale"><h1>ç”Ÿæ—¥å¿«æ¨‚ï¼ğŸ‚</h1></div>
<div class="s1-credit">This website was made by x8</div>
<div id="nav">
  <button id="prev-btn" disabled>â€¹</button>
  <div class="page-ind"><span id="page-num">1</span> / 4</div>
  <button id="next-btn">â€º</button>
</div>
<script>
// =============================================
// INTRO
// =============================================
gsap.to('.intro-content',{opacity:1,scale:1,duration:1.8,delay:.5,ease:'power2.out'});
gsap.to('.intro-hint',{opacity:1,duration:.8,delay:3,ease:'power2.out'});
document.getElementById('intro').addEventListener('click',function(){
    dismissIntro();
});
function dismissIntro(){
    gsap.to('#intro',{opacity:0,duration:.8,ease:'power2.in',onComplete:function(){
        document.getElementById('intro').style.display='none';
    }});
}

// =============================================
// MOBILE DETECTION & NOTICE
// =============================================
var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;
if(!isMobile){
    document.getElementById('notice-text').textContent = 'ğŸ‰ æº–å‚™å¥½äº†å—ï¼Ÿé»æ“Šé–‹å§‹æŒ‰éˆ•é–‹å§‹é«”é©—';
}

function startExperience(){
    document.getElementById('mobile-notice').classList.add('hide');
    initAnimations();
}

function initAnimations(){
    // Slide 1 entrance animations
    gsap.from('.s1-emoji',{scale:0,opacity:0,duration:1,delay:.3,ease:'elastic.out(1,.5)'});
    gsap.from('.s1-title',{scale:.3,opacity:0,duration:1.2,delay:.6,ease:'back.out(1.7)'});
    gsap.from('.s1-name',{y:50,opacity:0,duration:1,delay:1,ease:'power2.out'});
    gsap.from('.s1-sub',{y:30,opacity:0,duration:1,delay:1.3,ease:'power2.out'});
    // Confetti burst
    setTimeout(function(){
        confetti({particleCount:80,spread:100,origin:{x:.5,y:.5},colors:['#ff9a9e','#a18cd1','#96e6a1','#ffecd2','#fad0c4']});
    },800);
}

// =============================================
// MESSAGES â€” Edit this array easily!
// =============================================
var messages = [
  {name:"Ken", text:"æ°¸è‘†é’æ˜¥"},
  {name:"Hong", text:"èº«é«”å¥åº·"},
  {name:"19", text:"å¤šè¬ä½ "},
  {name:"é™³å¿—åƒ–", text:"ç”Ÿæ—¥å¿«æ¨‚"},
  {name:"æ­æ–‡ç‹„", text:"Miss Chan ç”Ÿæ—¥å¿«æ¨‚ï¼Œä¸è¦å†ç¶“å¸¸å“­"},
  {name:"x8", text:"Cherry happy bday !!11!!"},
  {name:"soso", text:"Cherry ç”Ÿæ—¥å¿«æ¨‚ ğŸ’‹ğŸ’‹"},
  {name:"æ¡", text:"ç¥ä½ ç”Ÿæ—¥å¿«æ¨‚ï¼é¡˜æ–°çš„ä¸€æ­²å¹³å®‰å–œæ¨‚ï¼Œè¬äº‹é †é‚ï¼Œæ‰€æœ‰ç¾å¥½å¦‚æœŸè€Œè‡³ï½ ğŸ‚"},
  {name:"ç›§çˆå»¶", text:"ç”Ÿæ—¥å¿«æ¨‚ ğŸ‚ğŸ‚"},
  {name:"Kiki", text:"ğŸ’ ç”Ÿæ—¥å¿«æ¨‚ ğŸ‚ï¼é¡˜ä½ å¤©å¤©å¥½å¿ƒæƒ…ï¼Œå°‘å°‘æ°£ Ù©(à¹‘`^Â´à¹‘)Û¶ã€å¤šå¤šç¬‘ (>^Ï‰^<)ï¼Œè¶Šæ´»è¶Šå°‘å¥³ï¼(^O^)"},
  {name:"Echo", text:"Happy for your 18years old Birthday,wish you in the coming year have a happier life ,donâ€™t cry~,but also wish you have more salaries in coming year"},
  {name:"Anderson", text:"å¸Œæœ›ä¸‹å¹´éƒ½ä»²ä¿‚ä½ æ•™"},
  {name:"ç‘¤.", text:"ğŸ’–Happy birthdayğŸ’–å¤©å¤©é–‹å¿ƒ"},
];

// Pastel glow colors for glass card borders
var GLOW_COLORS = [
  'rgba(255,154,158,.5)','rgba(161,140,209,.5)','rgba(150,230,161,.5)','rgba(255,236,210,.5)',
  'rgba(250,208,196,.5)','rgba(168,230,207,.5)','rgba(255,183,197,.5)','rgba(199,186,255,.5)',
  'rgba(162,235,222,.5)','rgba(255,218,185,.5)','rgba(200,168,255,.5)','rgba(255,200,200,.5)',
  'rgba(180,236,200,.5)','rgba(255,230,150,.5)','rgba(220,180,255,.5)','rgba(255,170,170,.5)',
  'rgba(170,220,255,.5)','rgba(255,200,230,.5)','rgba(180,255,200,.5)','rgba(255,210,160,.5)',
  'rgba(190,190,255,.5)','rgba(255,190,210,.5)','rgba(200,255,220,.5)','rgba(255,220,180,.5)',
  'rgba(210,200,255,.5)'
];

var VW = window.innerWidth, VH = window.innerHeight;

// =============================================
// MESH GRADIENT BLOB ANIMATION
// =============================================
document.querySelectorAll('.blob').forEach(function(b) {
    gsap.to(b, { x: (Math.random()-.5)*VW*.3, y: (Math.random()-.5)*VH*.3, duration: 8+Math.random()*6, repeat: -1, yoyo: true, ease: 'sine.inOut', delay: Math.random()*3 });
});

// =============================================
// FLOATING ICONS
// =============================================
var icons = ['â¤ï¸','â­','ğŸ˜Š','ğŸˆ','ğŸ','âœ¨','ğŸŒŸ','ğŸ‰','ğŸ’–','ğŸŒˆ'];
var fCont = document.getElementById('floaters');
for (var f = 0; f < 18; f++) {
    var el = document.createElement('div'); el.className = 'floater';
    el.textContent = icons[f % icons.length];
    el.style.left = Math.random()*100+'%'; el.style.top = Math.random()*100+'%';
    fCont.appendChild(el);
    gsap.to(el, { y: -(VH*(0.4+Math.random()*0.6)), x: (Math.random()-.5)*150, rotation: Math.random()*360, opacity: 0, duration: 6+Math.random()*8, repeat: -1, delay: Math.random()*6, ease: 'none' });
}

// =============================================
// SLIDE MANAGEMENT
// =============================================
var cur = 0, slides = [document.getElementById('slide-1'),document.getElementById('slide-2'),document.getElementById('slide-3'),document.getElementById('slide-4')];
var busy = false, s4Init = false, s3Init = false;
var prevBtn = document.getElementById('prev-btn'), nextBtn = document.getElementById('next-btn'), pageNum = document.getElementById('page-num');

function updNav() { prevBtn.disabled=cur===0||busy; nextBtn.disabled=cur===3||busy; pageNum.textContent=cur+1; }

function finishGo(from, to) {
    slides[from].classList.remove('active');
    gsap.set(slides[from],{visibility:'hidden',opacity:1,zIndex:2,x:0,scale:1,rotationY:0});
    // Reset inner elements of old slide
    gsap.set(slides[from].querySelectorAll('.s1-wrap,.s1-emoji,.s1-title,.s1-name,.s1-sub,.s2-photo,.s2-text,.s2-wrap,.photo-frame'),
        {x:0,y:0,scale:1,opacity:1,rotation:0,filter:'blur(0px)'});
    slides[to].classList.add('active'); gsap.set(slides[to],{zIndex:3});
    cur=to; busy=false; updNav();
    if(to===2&&!s3Init){s3Init=true;animatePhotos();}
    if(to===3&&!s4Init){s4Init=true;startWall();}
}

function go(idx) {
    if (busy||idx===cur||idx<0||idx>3) return;
    busy = true;
    var from=cur, to=idx;
    slides[to].style.visibility='visible'; slides[to].style.zIndex=4;
    gsap.set(slides[to],{opacity:1,x:0,scale:1});

    // ---- Slide 1 â†’ 2 : Zoom-through ----
    if (from===0 && to===1) {
        var tl=gsap.timeline({onComplete:function(){finishGo(0,1);}});
        // Slide 1 content zooms in and blurs away
        tl.to('.s1-emoji',{scale:4,opacity:0,duration:.6,ease:'power2.in'},'<');
        tl.to('.s1-title',{scale:3,opacity:0,filter:'blur(20px)',duration:.8,ease:'power2.in'},'<');
        tl.to('.s1-name',{y:-80,opacity:0,duration:.6,ease:'power2.in'},'<.1');
        tl.to('.s1-sub',{y:60,opacity:0,duration:.5,ease:'power2.in'},'<');
        // Slide 2 elements enter
        gsap.set('.s2-photo',{x:-VW*.3,opacity:0,rotation:-8});
        gsap.set('.s2-text',{x:VW*.3,opacity:0});
        tl.to('.s2-photo',{x:0,opacity:1,rotation:0,duration:.9,ease:'back.out(1.4)'},'>.1');
        tl.to('.s2-text',{x:0,opacity:1,duration:.9,ease:'power3.out'},'<.15');
    }
    // ---- Slide 2 â†’ 1 : Reverse zoom ----
    else if (from===1 && to===0) {
        var tl=gsap.timeline({onComplete:function(){finishGo(1,0);}});
        tl.to('.s2-photo',{x:-VW*.3,opacity:0,rotation:-8,duration:.6,ease:'power2.in'},'<');
        tl.to('.s2-text',{x:VW*.3,opacity:0,duration:.6,ease:'power2.in'},'<.05');
        // Slide 1 elements re-enter
        gsap.set('.s1-emoji',{scale:3,opacity:0});
        gsap.set('.s1-title',{scale:2,opacity:0,filter:'blur(15px)'});
        gsap.set('.s1-name',{y:-60,opacity:0});
        gsap.set('.s1-sub',{y:40,opacity:0});
        tl.to('.s1-title',{scale:1,opacity:1,filter:'blur(0px)',duration:.9,ease:'back.out(1.3)'},'>.1');
        tl.to('.s1-emoji',{scale:1,opacity:1,duration:.7,ease:'elastic.out(1,.6)'},'<.1');
        tl.to('.s1-name',{y:0,opacity:1,duration:.7,ease:'power2.out'},'<.15');
        tl.to('.s1-sub',{y:0,opacity:1,duration:.6,ease:'power2.out'},'<.1');
    }
    // ---- Slide 2 â†’ 3 : Photo gallery ----
    else if (from===1 && to===2) {
        var tl=gsap.timeline({onComplete:function(){finishGo(1,2);}});
        tl.to('.s2-photo',{x:-VW*.5,opacity:0,scale:.6,rotation:-15,duration:.8,ease:'power3.in'},'<');
        tl.to('.s2-text',{x:VW*.5,opacity:0,scale:.6,duration:.8,ease:'power3.in'},'<.05');
        gsap.set(slides[2],{opacity:0,scale:1.1});
        tl.to(slides[2],{opacity:1,scale:1,duration:.7,ease:'power2.out'},'>.05');
    }
    // ---- Slide 3 â†’ 2 : Back to tribute ----
    else if (from===2 && to===1) {
        var tl=gsap.timeline({onComplete:function(){finishGo(2,1);}});
        tl.to(slides[2],{opacity:0,scale:.9,duration:.6,ease:'power2.in'});
        gsap.set('.s2-photo',{x:-VW*.4,opacity:0,rotation:-10});
        gsap.set('.s2-text',{x:VW*.4,opacity:0});
        tl.to('.s2-photo',{x:0,opacity:1,rotation:0,duration:.9,ease:'back.out(1.3)'},'>.05');
        tl.to('.s2-text',{x:0,opacity:1,duration:.9,ease:'power3.out'},'<.15');
    }
    // ---- Slide 3 â†’ 4 : Photos scatter to card wall ----
    else if (from===2 && to===3) {
        var tl=gsap.timeline({onComplete:function(){finishGo(2,3);}});
        // Remove secret phrase immediately
        document.querySelectorAll('.secret-phrase').forEach(function(sp){sp.remove();});
        // Reset moved cards
        var allF=slides[2].querySelectorAll('.photo-frame');
        allF.forEach(function(f){gsap.set(f,{clearProps:'x,y,scale,opacity'});});
        var frames=slides[2].querySelectorAll('.photo-frame');
        frames.forEach(function(f,i){
            tl.to(f,{y:-VH*.3,opacity:0,scale:.5,rotation:(Math.random()-.5)*40,duration:.5,ease:'power2.in'},i*.06);
        });
        gsap.set(slides[3],{opacity:0,scale:1.1});
        tl.to(slides[3],{opacity:1,scale:1,duration:.7,ease:'power2.out'},'>.05');
    }
    // ---- Slide 4 â†’ 3 : Card wall back to photos ----
    else if (from===3 && to===2) {
        var tl=gsap.timeline({onComplete:function(){finishGo(3,2);}});
        tl.to(slides[3],{opacity:0,scale:.9,duration:.6,ease:'power2.in'});
        gsap.set(slides[2],{opacity:0,scale:1.05});
        tl.to(slides[2],{opacity:1,scale:1,duration:.7,ease:'power2.out'},'>.05');
    }
}

prevBtn.onclick=function(){go(cur-1)};
nextBtn.onclick=function(){go(cur+1)};
document.addEventListener('keydown',function(e){
    if(e.key==='ArrowRight'||e.key===' ')go(cur+1);
    if(e.key==='ArrowLeft')go(cur-1);
});

// =============================================
// SLIDE 3 â€” CHERRY BLIND BOX
// =============================================
// Cherry blind box images â€” shuffled randomly
var cherryBase='https://raw.githubusercontent.com/x8lua/x8stuff/main/bday/cherry/';
var cherryImages=[1,2,3,4,5];
for(var si=cherryImages.length-1;si>0;si--){var sj=Math.floor(Math.random()*(si+1));var tmp=cherryImages[si];cherryImages[si]=cherryImages[sj];cherryImages[sj]=tmp;}

function animatePhotos(){
    // Assign images
    var allFrames=Array.from(document.querySelectorAll('.photo-frame'));
    var lockedFrame=document.querySelector('.photo-frame[data-locked="true"]');
    var regularFrames=allFrames.filter(function(f){return f.dataset.locked!=='true';});
    var ri=0;
    regularFrames.forEach(function(f){
        f.querySelector('.photo-img').src=cherryBase+cherryImages[ri]+'.jpg';
        ri++;
    });
    lockedFrame.querySelector('.photo-img').src=cherryBase+'6.jpg';
    // Shuffle only regular cards, locked stays bottom-right
    for(var si=regularFrames.length-1;si>0;si--){var sj=Math.floor(Math.random()*(si+1));var tmp=regularFrames[si];regularFrames[si]=regularFrames[sj];regularFrames[sj]=tmp;}
    var rows=document.querySelectorAll('.photo-row');
    rows[0].innerHTML='';rows[1].innerHTML='';
    regularFrames.forEach(function(f,i){ (i<3?rows[0]:rows[1]).appendChild(f); });
    rows[1].appendChild(lockedFrame); // always last
    // Animate entrance
    var frames=Array.from(document.querySelectorAll('.photo-frame'));
    frames.forEach(function(f){
        gsap.set(f,{opacity:0,y:80,scale:.6,rotation:(Math.random()-.5)*30});
    });
    frames.forEach(function(f,i){
        gsap.to(f,{
            opacity:1,y:0,scale:1,rotation:0,
            duration:1,delay:i*.15,
            ease:'elastic.out(1,.6)',
            onComplete:function(){ if(f.dataset.locked!=='true') setupChest(f); }
        });
    });
    setTimeout(function(){document.getElementById('s3-sub').textContent='é»æ“Šç›²ç›’é–‹å•Ÿï¼ğŸ”’ è§£é–å…¨éƒ¨ä»¥é–‹å•Ÿç¥ç§˜ç›²ç›’';},frames.length*.15*1000+500);
}

function setupChest(frame){
    frame.addEventListener('click',function(){
        if(frame.classList.contains('unlocked')) return;
        var clicks=parseInt(frame.dataset.clicks)+1;
        var need=parseInt(frame.dataset.need);
        frame.dataset.clicks=clicks;
        // Update progress bar
        var pct=Math.min((clicks/need)*100,100);
        frame.querySelector('.chest-bar').style.width=pct+'%';
        // Update counter text
        var remaining=need-clicks;
        if(remaining>0){
            frame.querySelector('.chest-counter').textContent='é‚„å·® '+remaining+' æ¬¡ï¼';
        }
        // Shake animation
        frame.classList.remove('shake');
        void frame.offsetWidth; // force reflow
        frame.classList.add('shake');
        // Scale bump
        gsap.to(frame,{scale:1.08,duration:.1,yoyo:true,repeat:1,ease:'power2.out'});
        // Unlocked!
        if(clicks>=need){
            frame.querySelector('.chest-counter').textContent='é–‹å•Ÿä¸­...';
            if(frame.dataset.locked==='true'){
                revealSecretPhoto(frame);
            } else {
                // Normal unlock sequence
                gsap.to(frame,{scale:1.2,duration:.3,ease:'power2.in',onComplete:function(){
                    frame.classList.add('unlocked');
                    gsap.fromTo(frame,{boxShadow:'0 0 0px rgba(255,154,158,0)'},{boxShadow:'0 0 60px rgba(255,154,158,.7),0 0 120px rgba(161,140,209,.5)',duration:.5,yoyo:true,repeat:1});
                    gsap.to(frame,{scale:1,duration:.6,ease:'elastic.out(1,.5)'});
                    var rect=frame.getBoundingClientRect();
                    var cx=(rect.left+rect.width/2)/window.innerWidth;
                    var cy=(rect.top+rect.height/2)/window.innerHeight;
                    confetti({particleCount:40,spread:70,origin:{x:cx,y:cy},colors:['#ff9a9e','#a18cd1','#96e6a1','#ffecd2']});
                    setTimeout(function(){checkAllUnlocked();},800);
                }});
            }
        }
    });
}

function checkAllUnlocked(){
    var frames=document.querySelectorAll('.photo-frame:not([data-locked="true"])');
    var allDone=true;
    frames.forEach(function(f){if(!f.classList.contains('unlocked'))allDone=false;});
    if(allDone) unlockSecretCard();
}

function unlockSecretCard(){
    var locked=document.querySelector('.photo-frame[data-locked="true"]');
    if(!locked||locked.classList.contains('unlocking')) return;
    locked.classList.add('unlocking');
    var overlay=locked.querySelector('.locked-overlay');
    var lockIcon=overlay.querySelector('.lock-icon');
    var lockText=overlay.querySelector('.lock-text');
    var tl=gsap.timeline();
    // Glow pulse
    tl.to(locked,{boxShadow:'0 0 40px rgba(255,154,158,.8),0 0 80px rgba(161,140,209,.5)',duration:.5,ease:'power2.in'});
    // Shake intensely
    tl.to(locked.querySelector('.card-face'),{keyframes:[
        {x:-6,rotation:-3,duration:.05},{x:6,rotation:3,duration:.05},
        {x:-5,rotation:-2.5,duration:.05},{x:5,rotation:2.5,duration:.05},
        {x:-4,rotation:-2,duration:.05},{x:4,rotation:2,duration:.05},
        {x:-3,rotation:-1.5,duration:.05},{x:3,rotation:1.5,duration:.05},
        {x:0,rotation:0,duration:.05}
    ]});
    // Lock icon grows and shatters
    tl.to(lockIcon,{scale:2,duration:.3,ease:'power2.in'});
    tl.to(lockIcon,{scale:0,rotation:360,opacity:0,duration:.5,ease:'back.in(2)'});
    tl.to(lockText,{opacity:0,y:20,duration:.3,ease:'power2.in'},'<');
    // Overlay fades
    tl.to(overlay,{opacity:0,duration:.4,ease:'power2.out'});
    // Remove locked state, enable interaction
    tl.call(function(){
        locked.classList.remove('locked');
        locked.classList.remove('unlocking');
        overlay.style.display='none';
        locked.style.pointerEvents='';
        locked.style.cursor='pointer';
        locked.querySelector('.card-face').style.filter='';
        locked.querySelector('.chest-img').textContent='ğŸ';
        setupChest(locked);
    });
    // Bounce
    tl.fromTo(locked,{scale:1.15},{scale:1,duration:.8,ease:'elastic.out(1,.4)'});
    // Big confetti burst
    tl.call(function(){
        var rect=locked.getBoundingClientRect();
        var cx=(rect.left+rect.width/2)/window.innerWidth;
        var cy=(rect.top+rect.height/2)/window.innerHeight;
        confetti({particleCount:100,spread:120,origin:{x:cx,y:cy},colors:['#ff9a9e','#a18cd1','#96e6a1','#ffecd2','#fad0c4','#c7b6ff']});
    },'<');
    tl.call(function(){document.getElementById('s3-sub').textContent='ğŸ‰ ç¥ç§˜ç›²ç›’å·²è§£é–ï¼å¿«é»æ“Šé–‹å•Ÿï¼';});
}

function revealSecretPhoto(frame){
    if(frame.classList.contains('revealing')) return;
    frame.classList.add('revealing');
    var otherFrames=Array.from(document.querySelectorAll('.photo-frame:not([data-locked="true"])'));
    var tl=gsap.timeline();
    // Hide title & subtitle
    tl.to('.s3-title',{opacity:0,y:-30,duration:.5,ease:'power2.in'},'<');
    tl.to('#s3-sub',{opacity:0,duration:.4},'<');
    // Move cards to left/right sides (still visible as small thumbnails)
    var leftCards=otherFrames.slice(0,3);
    var rightCards=otherFrames.slice(3);
    leftCards.forEach(function(f,i){
        var r=f.getBoundingClientRect();
        var tx=VW*0.08;
        var ty=VH*(0.2+i*0.24);
        tl.to(f,{x:tx-(r.left+r.width/2),y:ty-(r.top+r.height/2),scale:.4,opacity:.45,duration:.9,ease:'power2.out'},i*.06);
    });
    rightCards.forEach(function(f,i){
        var r=f.getBoundingClientRect();
        var tx=VW*0.92;
        var ty=VH*(0.28+i*0.28);
        tl.to(f,{x:tx-(r.left+r.width/2),y:ty-(r.top+r.height/2),scale:.4,opacity:.45,duration:.9,ease:'power2.out'},i*.06);
    });
    // Hide progress/counter on secret card
    frame.querySelector('.chest-counter').style.display='none';
    frame.querySelector('.chest-progress').style.display='none';
    // Calculate offset to center
    var rect=frame.getBoundingClientRect();
    var dx=(VW/2)-(rect.left+rect.width/2);
    var dy=(VH*0.36)-(rect.top+rect.height/2);
    // Center and scale up
    tl.to(frame,{x:dx,y:dy,scale:1.6,duration:1,ease:'power2.out'},'+=.15');
    // Reveal photo
    tl.call(function(){ frame.classList.add('unlocked'); });
    // Glow burst
    tl.fromTo(frame,
        {boxShadow:'0 0 0 rgba(255,154,158,0)'},
        {boxShadow:'0 0 80px rgba(255,154,158,.6),0 0 150px rgba(161,140,209,.4)',duration:1,ease:'power2.out'}
    );
    // Show phrase
    var phrase=document.createElement('div');
    phrase.className='secret-phrase';
    phrase.textContent='ä¸€æ¨£çš„è–äº”ï¼Œä¸ä¸€æ¨£çš„èº«ä»½ï¼Œä½†ä¸€æ¨£æ˜¯æˆ‘å€‘æœ€æ„›çš„ Cherry';
    document.body.appendChild(phrase);
    gsap.set(phrase,{opacity:0,y:30});
    tl.to(phrase,{opacity:1,y:0,duration:1.2,ease:'power2.out'},'+=.2');
    // Big confetti
    tl.call(function(){
        confetti({particleCount:150,spread:160,origin:{x:.5,y:.5},colors:['#ff9a9e','#a18cd1','#96e6a1','#ffecd2','#fad0c4','#c7b6ff']});
    },'+=.3');
    // Side confetti streams
    tl.call(function(){
        var end=Date.now()+3000;
        (function burst(){
            confetti({particleCount:3,angle:60,spread:60,origin:{x:0,y:.6},colors:['#ff9a9e','#a18cd1','#96e6a1','#ffecd2']});
            confetti({particleCount:3,angle:120,spread:60,origin:{x:1,y:.6},colors:['#ff9a9e','#a18cd1','#96e6a1','#ffecd2']});
            if(Date.now()<end)requestAnimationFrame(burst);
        })();
    });
}

// =============================================
// SLIDE 4 â€” CARD WALL + JELLY EFFECT
// =============================================
var total=messages.length, COLS=5, ROWS=Math.ceil(total/COLS);
var gapX=VW*.012, gapY=VH*.015;
var cardW=(VW-(COLS+1)*gapX)/COLS, cardH=(VH-(ROWS+1)*gapY)/ROWS;
var ctrX=(VW-cardW)/2, ctrY=(VH-cardH)/2;
var stage=document.getElementById('stage'), backdrop=document.getElementById('backdrop'), finale=document.getElementById('finale');

function gp(i){return{x:gapX+(i%COLS)*(cardW+gapX),y:gapY+Math.floor(i/COLS)*(cardH+gapY)};}

// Jelly animation function
function jellyBounce(el) {
    gsap.timeline()
        .to(el,{scaleX:1.18,scaleY:.82,duration:.1,ease:'power1.out'})
        .to(el,{scaleX:.88,scaleY:1.12,duration:.1,ease:'power1.out'})
        .to(el,{scaleX:1.08,scaleY:.92,duration:.08,ease:'power1.out'})
        .to(el,{scaleX:.96,scaleY:1.04,duration:.08,ease:'power1.out'})
        .to(el,{scaleX:1,scaleY:1,duration:.12,ease:'power2.out'});
}

var cards = messages.map(function(msg,i){
    var pos=gp(i), glow=GLOW_COLORS[i%GLOW_COLORS.length];
    var c=document.createElement('div'); c.className='card';
    c.style.cssText='width:'+cardW+'px;height:'+cardH+'px;left:'+pos.x+'px;top:'+pos.y+'px;box-shadow:0 0 20px '+glow+',inset 0 0 20px rgba(255,255,255,.03)';
    c.innerHTML='<div class="card-label">ç•™è¨€</div>'
        +'<div class="card-msg">'+msg.text+'</div>'
        +'<div class="card-author">â€” '+msg.name+'</div>';
    stage.appendChild(c);
    // Jelly on hover (only after landed)
    c.addEventListener('mouseenter',function(){
        if(c.dataset.landed) jellyBounce(c);
    });
    return {el:c,pos:pos};
});

function startWall(){
    var master=gsap.timeline({delay:.4});
    cards.forEach(function(item,i){
        var el=item.el,pos=item.pos;
        var ox=ctrX-pos.x,oy=ctrY-pos.y;
        var rot=(Math.random()*10-5), tl=gsap.timeline();
        gsap.set(el,{x:ox,y:oy,scale:2.5,opacity:0});

        tl.call(function(){el.style.zIndex=60;});
        tl.to(backdrop,{opacity:1,duration:.2,ease:'power1.in'},'<');
        tl.to(el,{scale:1.5,opacity:1,duration:.7,ease:'back.out(1.7)',boxShadow:'0 0 50px rgba(255,255,255,.3),0 0 20px '+GLOW_COLORS[i%GLOW_COLORS.length]});
        tl.to(el,{duration:5});
        tl.to(backdrop,{opacity:0,duration:.2,ease:'power1.out'});
        tl.to(el,{x:0,y:0,scale:1,rotation:rot,duration:.8,ease:'back.out(2)',
            boxShadow:'0 0 20px '+GLOW_COLORS[i%GLOW_COLORS.length]+',inset 0 0 20px rgba(255,255,255,.03)',
            onComplete:function(){el.dataset.landed='1'; jellyBounce(el);}
        });
        tl.call(function(){el.style.zIndex=1;});
        master.add(tl,i>0?'-=.1':0);
    });

    // Random jelly jumps after all cards land
    master.call(function(){
        setInterval(function(){
            var ri=Math.floor(Math.random()*cards.length);
            jellyBounce(cards[ri].el);
        },2000);
    });

    // FINALE â€” confetti
    master.call(function(){
        gsap.to(finale,{opacity:1,duration:1,ease:'power2.in'});
        gsap.fromTo(finale.querySelector('h1'),{scale:.3},{scale:1,duration:1.2,ease:'elastic.out(1,.4)'});
        var end=Date.now()+5000;
        (function frame(){
            confetti({particleCount:4,angle:60,spread:80,origin:{x:0,y:.7},colors:['#ff9a9e','#a18cd1','#96e6a1','#ffecd2','#fad0c4']});
            confetti({particleCount:4,angle:120,spread:80,origin:{x:1,y:.7},colors:['#ff9a9e','#a18cd1','#96e6a1','#ffecd2','#fad0c4']});
            if(Date.now()<end)requestAnimationFrame(frame);
        })();
        setTimeout(function(){
            confetti({particleCount:200,spread:160,origin:{x:.5,y:.5},colors:['#ff9a9e','#a18cd1','#96e6a1','#ffecd2','#fad0c4','#c7b6ff']});
        },500);
    });
}
twemoji.parse(document.body);
</script>
</body>
</html>
